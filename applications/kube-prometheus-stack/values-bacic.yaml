---
# Basic production-ready values with non-root security
prometheus:
  prometheusSpec:
    retention: 30d
    retentionSize: 50GiB
    storageSpec:
      volumeClaimTemplate:
        spec:
          accessModes: [ReadWriteOnce]
          resources:
            requests:
              storage: 50Gi
    # Non-root security context for Prometheus
    securityContext:
      runAsGroup: 2000
      runAsNonRoot: true
      runAsUser: 1000
      fsGroup: 2000
      seccompProfile:
        type: RuntimeDefault
    containers:
      - name: prometheus
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          capabilities:
            drop: [ALL]
# AlertManager with non-root security
alertmanager:
  alertmanagerSpec:
    storage:
      volumeClaimTemplate:
        spec:
          accessModes: [ReadWriteOnce]
          resources:
            requests:
              storage: 5Gi
    # Non-root security context for AlertManager
    securityContext:
      runAsGroup: 2000
      runAsNonRoot: true
      runAsUser: 1000
      fsGroup: 2000
      seccompProfile:
        type: RuntimeDefault
    containers:
      - name: alertmanager
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          capabilities:
            drop: [ALL]
# Prometheus Operator with non-root security
prometheusOperator:
  securityContext:
    runAsGroup: 2000
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 2000
    seccompProfile:
      type: RuntimeDefault
  containerSecurityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
    capabilities:
      drop: [ALL]
  admissionWebhooks:
    failurePolicy: Ignore
    patch:
      securityContext:
        runAsGroup: 2000
        runAsNonRoot: true
        runAsUser: 2000
# Node Exporter with appropriate security (needs some host access)
nodeExporter:
  securityContext:
    runAsGroup: 65534
    runAsNonRoot: true
    runAsUser: 65534
    fsGroup: 65534
  containerSecurityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
    capabilities:
      drop: [ALL]
# Kube State Metrics with non-root security
kubeStateMetrics:
  securityContext:
    runAsGroup: 65534
    runAsNonRoot: true
    runAsUser: 65534
    fsGroup: 65534
  containerSecurityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
    capabilities:
      drop: [ALL]
grafana:
  adminPassword: ''  # Generates random 40-char password
  persistence:
    enabled: true
    size: 10Gi
  initChownData:
    enabled: false

  # Non-root security context for Grafana (Grafana runs as UID 472 by default)
  securityContext:
    runAsGroup: 472
    runAsNonRoot: true
    runAsUser: 472
    fsGroup: 472
    seccompProfile:
      type: RuntimeDefault
  containerSecurityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false  # Grafana needs to write to some directories
    capabilities:
      drop: [ALL]

  # Enable sidecar for automatic datasource discovery
  sidecar:
    datasources:
      enabled: true
      defaultDatasourceEnabled: true
      securityContext:
        runAsNonRoot: true
        runAsUser: 472
        runAsGroup: 472
        allowPrivilegeEscalation: false
        readOnlyRootFilesystem: true
        capabilities:
          drop: [ALL]
    dashboards:
      enabled: true
      searchNamespace: ALL
      securityContext:
        runAsNonRoot: true
        runAsUser: 472
        runAsGroup: 472
        allowPrivilegeEscalation: false
        readOnlyRootFilesystem: true
        capabilities:
          drop: [ALL]

  # Additional data sources including Loki
  additionalDataSources:
    - name: Loki
      type: loki
      url: http://loki-gateway.monitoring.svc.cluster.local
      access: proxy
      isDefault: false
      editable: true
      jsonData:
        maxLines: 1000
  dashboardProviders:
    dashboardproviders.yaml:
      apiVersion: 1
      providers:
        - name: default
          orgId: 1
          folder: ''
          type: file
          disableDeletion: false
          editable: true
          options:
            path: /var/lib/grafana/dashboards/default
  dashboards:
    default:
      # Kubernetes metrics dashboards
      kubernetes-cluster:
        gnetId: 7249
        revision: 1
        datasource: Prometheus
      kubernetes-pods:
        gnetId: 6417
        revision: 1
        datasource: Prometheus
      node-exporter:
        gnetId: 1860
        revision: 27
        datasource: Prometheus
      # Loki logs dashboard
      loki-logs:
        gnetId: 13639
        revision: 2
        datasource: Loki
